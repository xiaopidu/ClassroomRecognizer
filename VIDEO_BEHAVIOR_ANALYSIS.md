# 视频行为分析功能说明

## 功能概述

本系统实现了基于YOLOv8的教室场景学生行为识别功能，能够分析视频中学生的注意力状态、手部活动和桌面物品，为教学质量评估提供数据支持。

## 技术架构

### 后端组件
- **behavior_service.py**: 核心行为分析服务
  - 使用YOLOv8 Pose进行姿态检测
  - 使用YOLOv8 Object Detection进行物体识别
  - 分析学生头部姿态（抬头/低头/中性）
  - 分析学生手部活动（记笔记/玩手机/休息）
  - 识别桌面物品（书本/电脑/手机）

### 前端组件
- **VideoAnalyzer.tsx**: 视频行为分析界面
  - 视频上传和预览
  - 时间段选择（5分钟/45分钟）
  - 进度显示和结果展示
  - 行为统计图表可视化

### API接口
- `/api/behavior-analyze-base64`: 单帧行为分析
- `/api/behavior-analyze-video-base64`: 多帧行为分析和汇总

## 功能特性

### 1. 视频处理流程
1. 用户上传视频文件
2. 选择分析时间段（开始时间和时长）
3. 系统提取视频帧（降频至适当帧率）
4. 对每帧进行行为分析
5. 汇总所有帧的分析结果
6. 生成可视化报告

### 2. 行为识别能力
- **头部姿态识别**:
  - 抬头 (looking_up): 积极关注教学内容
  - 低头 (looking_down): 注意力分散
  - 中性 (neutral): 正常状态

- **手部活动识别**:
  - 记笔记 (writing): 学习积极性高
  - 玩手机 (using_phone): 注意力分散
  - 休息 (resting): 正常状态
  - 未知 (unknown): 无法识别

- **桌面物品识别**:
  - 书本 (book)
  - 电脑 (laptop)
  - 手机 (cell phone)

### 3. 结果可视化
- 实时进度显示
- 行为分布饼图
- 桌面物品统计柱状图
- 分析结论文本报告
- 帧结果预览和详情查看

## 使用方法

### 前端使用
1. 访问视频行为分析页面
2. 上传视频文件
3. 设置分析时间段
4. 点击"开始分析"
5. 查看分析结果和图表
6. 导出报告或标注帧

### 后端API调用
```bash
# 单帧分析
curl -X POST http://localhost:5001/api/behavior-analyze-base64 \
  -H "Content-Type: application/json" \
  -d '{"image": "data:image/jpeg;base64,..."}'

# 多帧分析
curl -X POST http://localhost:5001/api/behavior-analyze-video-base64 \
  -H "Content-Type: application/json" \
  -d '{"images": ["data:image/jpeg;base64,...", "..."]}'
```

## 性能优化

### 模型优化
- 使用CPU执行提供者以确保兼容性
- 预加载模型以减少首次分析延迟
- 合理设置检测参数平衡精度和速度

### 处理优化
- 视频帧降频处理减少计算量
- 批量处理提高吞吐量
- 异步处理避免阻塞主线程

## 扩展性设计

### 可扩展功能
1. **更多行为识别**: 可以轻松添加新的行为类别
2. **自定义规则**: 支持配置不同的分析规则
3. **实时分析**: 可扩展为实时视频流分析
4. **多摄像头支持**: 支持多个角度的视频分析

### 模型更新
- 支持更换YOLOv8模型版本
- 可集成其他专用模型
- 支持模型微调和优化

## 部署要求

### 硬件要求
- CPU: 4核以上
- 内存: 8GB以上
- 存储: 足够存储视频文件和临时数据

### 软件依赖
- Python 3.8+
- Flask
- OpenCV
- Ultralytics (YOLOv8)
- NumPy, Pillow等

### 环境配置
```bash
pip install -r backend/requirements.txt
```

## 测试验证

### 单元测试
- 模型加载测试
- 图像处理测试
- API接口测试

### 集成测试
- 完整视频分析流程测试
- 前后端联调测试
- 性能压力测试

## 未来改进方向

1. **精度提升**: 通过迁移学习优化模型精度
2. **速度优化**: 使用模型量化和加速推理
3. **功能扩展**: 添加更多行为类别和分析维度
4. **用户体验**: 优化界面交互和响应速度
5. **数据分析**: 提供更深入的数据洞察和趋势分析